server {
    listen 80;
    server_name localhost smartcambridge.org tfc-app1.cl.cam.ac.uk tfc-app2.cl.cam.ac.uk tfc-app3.cl.cam.ac.uk;

    error_log /var/log/nginx.err;

    access_log /dev/null; 

######################################################################
################ Nginx static files  #################################
######################################################################

    error_page 404 /404.html;

    location = /404.html {
        root /home/tfc_prod/tfc_prod/www/;
    }
    
    location / {
        root /home/tfc_prod/tfc_prod/www/;
        index index.html;
    }
    
    location /static {
        root /home/tfc_prod/tfc_prod/www;
    }
        
    location /images {
        root /home/tfc_prod/tfc_prod/www;
    }
        
    location /backdoor {
        root /home/tfc_prod/tfc_prod/www;
        index index.html;
    }
    
######################################################################
###################### FeedHandler  ##################################
######################################################################
    location /feedhandler/vix {
        proxy_pass http://localhost:8085;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
######################################################################
###################### Console      ##################################
######################################################################
    location /backdoor/console {
        proxy_pass http://localhost:8081/console;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/console/ {
        proxy_pass http://localhost:8081/api/console/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
######################################################################
###################### Rita         ##################################
######################################################################
    location /backdoor/rita {
        proxy_pass http://localhost:8082/rita;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

######################################################################
###################### Dataserver   ##################################
######################################################################

    location /backdoor/dataserver {
        proxy_pass http://localhost:8084/dataserver;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/dataserver/ {
        proxy_pass http://localhost:8084/api/dataserver/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
######################################################################
###################### Test port 8099   ##############################
######################################################################

    location /test/ {
        proxy_pass http://localhost:8099/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

######################################################################
###################### /test_proxy  ##################################
######################################################################
    location /test_proxy {
        add_header Content-Type text/plain;
        return 200 "Successful test of http proxy on $host ";
    }
    
###############################################################################
# Include LOCAL additional rules from /etc/nginx/includes/local_port_80.conf ##
# Note these are for additional local rules on port 80 only. If you want to  ##
# use other ports, you can create another 'server' directive in a new file   ##
# in /etc/nginx/sites-available.                                             ##
#                                                                            ##
# Note that /etc/nginx/includes MUST exist for nginx to start at all...      ##
###############################################################################

    include includes/*_port_80.conf;
}

